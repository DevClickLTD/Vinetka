name: Auto-translate Blog Content

# Ğ¡Ñ‚Ğ°Ñ€Ñ‚Ğ¸Ñ€Ğ° Ğ²ÑĞµĞºĞ¸ Ğ´ĞµĞ½ Ğ² 18:00 Bulgarian time (16:00 UTC)
on:
  schedule:
    - cron: '0 16 * * *'  # Every day at 16:00 UTC (18:00 Bulgarian time)
  
  # ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞ²Ğ° Ñ€ÑŠÑ‡Ğ½Ğ¾ ÑÑ‚Ğ°Ñ€Ñ‚Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ¾Ñ‚ GitHub Actions UI
  workflow_dispatch:

jobs:
  translate-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout ĞºĞ¾Ğ´Ğ°
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      # 2. Setup Node.js
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      # 3. Ğ˜Ğ½ÑÑ‚Ğ°Ğ»Ğ¸Ñ€Ğ°Ğ¹ dependencies
      - name: ğŸ“¦ Install dependencies
        run: npm ci
      
      # 4. Ğ¡Ñ‚Ğ°Ñ€Ñ‚Ğ¸Ñ€Ğ°Ğ¹ Ğ¿Ñ€ĞµĞ²Ğ¾Ğ´ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°
      - name: ğŸŒ Run translation script
        run: npm run translate
        env:
          NODE_ENV: production
      
      # 5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸ Ğ´Ğ°Ğ»Ğ¸ Ğ¸Ğ¼Ğ° Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ½Ğ¸
      - name: ğŸ” Check for changes
        id: check_changes
        run: |
          if git diff --quiet messages/wordpress-content.json; then
            echo "has_changes=false" >> $GITHUB_OUTPUT
            echo "â„¹ï¸ No new translations"
          else
            echo "has_changes=true" >> $GITHUB_OUTPUT
            echo "âœ… New translations detected"
          fi
      
      # 6. Commit Ğ¸ push Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ (ÑĞ°Ğ¼Ğ¾ Ğ°ĞºĞ¾ Ğ¸Ğ¼Ğ° Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ½Ğ¸)
      - name: ğŸ’¾ Commit and push translations
        if: steps.check_changes.outputs.has_changes == 'true'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ğŸŒ Auto-translation: Daily blog update'
          file_pattern: 'messages/wordpress-content.json'
          commit_user_name: 'Vinetka Bot'
          commit_user_email: 'bot@vinetka.bg'
          commit_author: 'Vinetka Bot <bot@vinetka.bg>'
      
      # 7. Success notification
      - name: âœ… Translation completed
        if: steps.check_changes.outputs.has_changes == 'true'
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… AUTO-TRANSLATION SUCCESSFUL"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "New translations have been committed."
          echo "Vercel will auto-deploy the changes."
          echo ""
      
      # 8. No changes notification
      - name: â„¹ï¸ No new content
        if: steps.check_changes.outputs.has_changes == 'false'
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "â„¹ï¸ NO NEW CONTENT TO TRANSLATE"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "All blog content is already translated."
          echo "No deployment needed."
          echo ""
